"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[557],{8146:function(e,a,t){t.d(a,{Tm:function(){return m},B6:function(){return c},yM:function(){return h},YM:function(){return g},a$:function(){return p},fj:function(){return N}});var r=t(7437),l=t(2265),n=t(3448);function s(e){let{isOpen:a,onClose:t,title:n,deals:s}=e,d=(0,l.useRef)(null),o=(0,l.useRef)(null),[i,c]=(0,l.useState)(""),u=(0,l.useMemo)(()=>{if(!i.trim())return s;let e=i.toLowerCase();return s.filter(a=>{var t,r,l,n;return a.id.toString().includes(e)||(null===(t=a.title)||void 0===t?void 0:t.toLowerCase().includes(e))||(null===(r=a.pipeline)||void 0===r?void 0:r.toLowerCase().includes(e))||(null===(l=a.stage)||void 0===l?void 0:l.toLowerCase().includes(e))||(null===(n=a.nome_noivo)||void 0===n?void 0:n.toLowerCase().includes(e))})},[s,i]);return((0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t()};return a&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden",setTimeout(()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()},100)),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[a,t]),(0,l.useEffect)(()=>{a||c("")},[a]),a)?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:e=>e.target===e.currentTarget&&t(),children:(0,r.jsxs)("div",{ref:d,className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] flex flex-col",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold text-gray-800",children:[n," (",u.length,i?" de ".concat(s.length):"",")"]}),(0,r.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),(0,r.jsx)("div",{className:"px-4 pt-4",children:(0,r.jsx)("input",{ref:o,type:"text",placeholder:"Buscar por ID, t\xedtulo, pipeline, stage ou nome...",value:i,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})}),(0,r.jsx)("div",{className:"overflow-auto flex-1 p-4",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-gray-100 sticky top-0",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left p-2",children:"ID"}),(0,r.jsx)("th",{className:"text-left p-2",children:"T\xedtulo"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Pipeline"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Stage"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Status"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Criado"})]})}),(0,r.jsxs)("tbody",{children:[u.map(e=>(0,r.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"p-2",children:e.id}),(0,r.jsx)("td",{className:"p-2",children:e.title||"-"}),(0,r.jsx)("td",{className:"p-2",children:e.pipeline||"-"}),(0,r.jsx)("td",{className:"p-2",children:e.stage||"-"}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("Won"===e.status?"bg-green-100 text-green-800":"Lost"===e.status?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:e.status||"Open"})}),(0,r.jsx)("td",{className:"p-2",children:e.created_at?new Date(e.created_at).toLocaleDateString("pt-BR"):"-"})]},e.id)),0===u.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,className:"text-center p-8 text-gray-500",children:i?"Nenhum resultado encontrado":"Nenhum deal encontrado"})})]})]})})]})}):null}let d=["Leads","MQL","Agendamento","Reuni\xf5es","Qualificado","Closer Agendada","Closer realizada","Vendas","CPL","CVR (MQL)","CVR (Ag)","CVR (Reu)","CVR (SQL)","CVR (RA)","CVR (RR)","CVR (Venda)","Convers\xe3o","M\xe9dia Score"],o=["SDR Weddings","Closer Weddings","Planejamento Weddings"];function i(e,a,t){if(!e)return!1;let r=new Date(e);return r.getFullYear()===a&&r.getMonth()+1===t}function c(e){let{metrics:a,target:t,previousMetrics:c,monthProgress:u,cpl:m,deals:g=[],year:h=new Date().getFullYear(),month:x=new Date().getMonth()+1}=e,[f,p]=(0,l.useState)(!1),[v,b]=(0,l.useState)(""),[j,N]=(0,l.useState)([]),y=(0,n.d)(a);c&&(0,n.d)(c);let w=e=>{switch(e){case"leads":return g;case"mql":return g.filter(e=>e.pipeline&&o.includes(e.pipeline));case"agendamento":return g.filter(e=>i(e.data_reuniao_1,h,x));case"reunioes":return g.filter(e=>i(e.data_reuniao_1,h,x)&&null!==e.como_reuniao_1&&""!==e.como_reuniao_1&&"N\xe3o teve reuni\xe3o"!==e.como_reuniao_1);case"qualificado":return g.filter(e=>i(e.data_qualificado,h,x)||!0===e.qualificado_sql);case"closerAgendada":return g.filter(e=>i(e.data_closer,h,x)||null!==e.data_closer&&""!==e.data_closer);case"closerRealizada":return g.filter(e=>null!==e.reuniao_closer&&""!==e.reuniao_closer);case"vendas":return g.filter(e=>{var a;return i(e.data_fechamento,h,x)&&!(null===(a=e.title)||void 0===a?void 0:a.startsWith("EW"))});default:return[]}},_=(e,a)=>{g.length&&(b(a),N(w(e)),p(!0))},q=t||{month:"",pipeline_type:"wedding",leads:0,mql:0,agendamento:0,reunioes:0,qualificado:0,closer_agendada:0,closer_realizada:0,vendas:0,cpl:0},R=[q.leads,q.mql,q.agendamento,q.reunioes,q.qualificado,q.closer_agendada,q.closer_realizada,q.vendas,(0,n.xG)(q.cpl),"70,00%","45,00%","70,00%","65,00%","100,00%","87,00%","35,00%","4,00%",""],T=[{stage:"leads",label:"Leads",value:a.leads},{stage:"mql",label:"MQL",value:a.mql},{stage:"agendamento",label:"Agendamento",value:a.agendamento},{stage:"reunioes",label:"Reuni\xf5es",value:a.reunioes},{stage:"qualificado",label:"Qualificado",value:a.qualificado},{stage:"closerAgendada",label:"Closer Agendada",value:a.closerAgendada},{stage:"closerRealizada",label:"Closer Realizada",value:a.closerRealizada},{stage:"vendas",label:"Vendas",value:a.vendas}],C=[a.leads,a.mql,a.agendamento,a.reunioes,a.qualificado,a.closerAgendada,a.closerRealizada,a.vendas,(0,n.xG)(m),(0,n.T3)(y.cvrMql),(0,n.T3)(y.cvrAg),(0,n.T3)(y.cvrReu),(0,n.T3)(y.cvrSql),(0,n.T3)(y.cvrRa),(0,n.T3)(y.cvrRr),(0,n.T3)(y.cvrVenda),(0,n.T3)(y.conversaoTotal),""],S=[(0,n.T3)((0,n.up)(a.leads,q.leads)),(0,n.T3)((0,n.up)(a.mql,q.mql)),(0,n.T3)((0,n.up)(a.agendamento,q.agendamento)),(0,n.T3)((0,n.up)(a.reunioes,q.reunioes)),(0,n.T3)((0,n.up)(a.qualificado,q.qualificado)),(0,n.T3)((0,n.up)(a.closerAgendada,q.closer_agendada)),(0,n.T3)((0,n.up)(a.closerRealizada,q.closer_realizada)),(0,n.T3)((0,n.up)(a.vendas,q.vendas)),"","","","","","","","","",""],A=[(0,n.Um)(q.leads,u),(0,n.Um)(q.mql,u),(0,n.Um)(q.agendamento,u),(0,n.Um)(q.reunioes,u),(0,n.Um)(q.qualificado,u),(0,n.Um)(q.closer_agendada,u),(0,n.Um)(q.closer_realizada,u),(0,n.Um)(q.vendas,u),"","","","","","","","","",""],D=c?[(0,n.T3)((0,n.up)(a.leads,c.leads)-100),(0,n.T3)((0,n.up)(a.mql,c.mql)-100),(0,n.T3)((0,n.up)(a.agendamento,c.agendamento)-100),(0,n.T3)((0,n.up)(a.reunioes,c.reunioes)-100),(0,n.T3)((0,n.up)(a.qualificado,c.qualificado)-100),(0,n.T3)((0,n.up)(a.closerAgendada,c.closerAgendada)-100),(0,n.T3)((0,n.up)(a.closerRealizada,c.closerRealizada)-100),"","","","","","","","","","",""]:Array(18).fill(""),z=c?[c.leads,c.mql,c.agendamento,c.reunioes,c.qualificado,c.closerAgendada,c.closerRealizada,c.vendas,"","","","","","","","","",""]:Array(18).fill(""),M=[(0,n.xG)(m*a.leads),(0,n.xG)(1.5*m*a.mql),(0,n.xG)(2*m*a.agendamento),(0,n.xG)(2.5*m*a.reunioes),(0,n.xG)(3*m*a.qualificado),(0,n.xG)(3.5*m*a.closerAgendada),(0,n.xG)(4*m*a.closerRealizada),"","","","","","","","","","",""];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"funnel-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"w-32"}),d.map((e,a)=>(0,r.jsx)("th",{children:e},a))]})}),(0,r.jsx)("tbody",{children:[{label:"Planejado",data:R,className:"row-planejado"},{label:"Realizado",data:C,className:"row-realizado"},{label:"Atingimento (%)",data:S,className:"row-atingimento"},{label:"Deveria",data:A,className:"row-deveria"},{label:"Per\xedodo anterior (%)",data:D,className:"row-periodo-anterior-pct"},{label:"Per\xedodo Anterior",data:z,className:"row-periodo-anterior"},{label:"Custos",data:M,className:"row-custos"}].map((e,a)=>(0,r.jsxs)("tr",{className:e.className,children:[(0,r.jsx)("td",{className:"font-semibold text-left bg-gray-100",children:e.label}),e.data.map((a,t)=>{let l="Realizado"===e.label&&t<8&&g.length>0;return(0,r.jsx)("td",{className:"".concat("string"==typeof a&&a.startsWith("-")?"negative":""," ").concat(l?"cursor-pointer hover:bg-primary/10 hover:text-primary transition-colors":""),onClick:l?()=>_(T[t].stage,T[t].label):void 0,children:l?(0,r.jsx)("span",{className:"underline decoration-dotted",children:a}):a},t)})]},a))})]})}),(0,r.jsx)(s,{isOpen:f,onClose:()=>p(!1),title:v,deals:j})]})}let u=["Leads","Vendas","CVR (Leads → Vendas)","M\xe9dia Score"];function m(e){let{metrics:a,target:t,previousMetrics:d,deals:o=[],year:i=new Date().getFullYear(),month:c=new Date().getMonth()+1}=e,[m,g]=(0,l.useState)(!1),[h,x]=(0,l.useState)(""),[f,p]=(0,l.useState)([]),v=(0,n.d5)(a.leads,a.vendas),b=e=>{switch(e){case"leads":return o;case"vendas":return o.filter(e=>(function(e,a,t){if(!e)return!1;let r=new Date(e);return r.getFullYear()===a&&r.getMonth()+1===t})(e.data_fechamento,i,c));default:return[]}},j=(e,a)=>{o.length&&(x(a),p(b(e)),g(!0))},N=[{stage:"leads",label:"Leads"},{stage:"vendas",label:"Vendas"}],y=t||{leads:0,vendas:0},w=[{label:"Planejado",data:[y.leads,y.vendas,"—","—"],className:"row-planejado"},{label:"Realizado",data:[a.leads,a.vendas,(0,n.T3)(v),"50"],className:"row-realizado"},{label:"Atingimento (%)",data:[(0,n.T3)((0,n.up)(a.leads,y.leads)),(0,n.T3)((0,n.up)(a.vendas,y.vendas)),"—","—"],className:"row-atingimento"},{label:"Per\xedodo Anterior",data:d?[d.leads,d.vendas,(0,n.T3)((0,n.d5)(d.leads,d.vendas)),"—"]:["—","—","—","—"],className:"row-periodo-anterior"}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"funnel-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"w-32"}),u.map((e,a)=>(0,r.jsx)("th",{children:e},a))]})}),(0,r.jsx)("tbody",{children:w.map((e,a)=>(0,r.jsxs)("tr",{className:e.className,children:[(0,r.jsx)("td",{className:"font-semibold text-left bg-gray-100",children:e.label}),e.data.map((a,t)=>{let l="Realizado"===e.label&&t<2&&o.length>0;return(0,r.jsx)("td",{className:l?"cursor-pointer hover:bg-primary/10 hover:text-primary transition-colors":"",onClick:l?()=>j(N[t].stage,N[t].label):void 0,children:l?(0,r.jsx)("span",{className:"underline decoration-dotted",children:a}):a},t)})]},a))})]})}),(0,r.jsx)(s,{isOpen:m,onClose:()=>g(!1),title:h,deals:f})]})}function g(e){let{monthProgress:a,resultProgress:t,investment:l}=e;return(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-primary",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Percorrido M\xeas"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-primary",children:(0,n.T3)(a)})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-primary",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Resultado At\xe9 o Momento"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-primary",children:(0,n.T3)(t)})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-primary",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Investimento At\xe9 o Momento"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-primary",children:(0,n.xG)(l)})]})]})}function h(e){let{selectedMonth:a,lastUpdate:t}=e,l=a.toLocaleDateString("pt-BR",{month:"long"}).toUpperCase(),n=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),s=new Date(a.getFullYear(),a.getMonth(),1),d=new Date(a.getFullYear(),a.getMonth()+1,0);return(0,r.jsxs)("div",{className:"bg-primary text-white rounded-t-lg",children:[(0,r.jsx)("div",{className:"text-center py-2 text-2xl font-bold border-b border-primary-dark",children:l}),(0,r.jsxs)("div",{className:"grid grid-cols-6 text-sm",children:[(0,r.jsxs)("div",{className:"border-r border-primary-dark p-2",children:[(0,r.jsx)("div",{className:"text-primary-light text-xs",children:"Dias do M\xeas"}),(0,r.jsx)("div",{className:"font-semibold",children:n})]}),(0,r.jsxs)("div",{className:"border-r border-primary-dark p-2",children:[(0,r.jsx)("div",{className:"text-primary-light text-xs",children:"Data de Hoje"}),(0,r.jsx)("div",{className:"font-semibold",children:x(new Date)})]}),(0,r.jsxs)("div",{className:"border-r border-primary-dark p-2",children:[(0,r.jsx)("div",{className:"text-primary-light text-xs",children:"Data in\xedcio"}),(0,r.jsx)("div",{className:"font-semibold",children:x(s)})]}),(0,r.jsxs)("div",{className:"border-r border-primary-dark p-2",children:[(0,r.jsx)("div",{className:"text-primary-light text-xs",children:"Data fim"}),(0,r.jsx)("div",{className:"font-semibold",children:x(d)})]}),(0,r.jsxs)("div",{className:"border-r border-primary-dark p-2",children:[(0,r.jsx)("div",{className:"text-primary-light text-xs",children:"Data Atualiza\xe7\xe3o"}),(0,r.jsx)("div",{className:"font-semibold",children:x(t)})]}),(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsx)("div",{className:"text-primary-light text-xs",children:"\xa0"}),(0,r.jsx)("div",{children:"\xa0"})]})]})]})}function x(e){let a=String(e.getDate()).padStart(2,"0"),t=String(e.getMonth()+1).padStart(2,"0"),r=e.getFullYear();return"".concat(a,"/").concat(t,"/").concat(r)}let f=["Janeiro","Fevereiro","Mar\xe7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];function p(e){let{selectedYear:a,selectedMonth:t,onChange:l}=e,n=new Date().getFullYear(),s=Array.from({length:5},(e,a)=>n-2+a);return(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,r.jsx)("select",{value:t,onChange:e=>l(a,Number(e.target.value)),className:"border border-gray-300 rounded px-3 py-2 bg-white",children:f.map((e,a)=>(0,r.jsx)("option",{value:a+1,children:e},a))}),(0,r.jsx)("select",{value:a,onChange:e=>l(Number(e.target.value),t),className:"border border-gray-300 rounded px-3 py-2 bg-white",children:s.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]})}var v=t(7648),b=t(9376);let j=[{href:"/total",label:"Total"},{href:"/wedding",label:"WW General"},{href:"/elopement",label:"Elopement"}];function N(e){let{year:a,month:t}=e,l=(0,b.usePathname)(),n=e=>a&&t?"".concat(e,"?year=").concat(a,"&month=").concat(t):e;return(0,r.jsx)("div",{className:"flex rounded-lg overflow-hidden border border-primary",children:j.map(e=>(0,r.jsx)(v.default,{href:n(e.href),className:"px-4 py-2 font-medium transition-colors ".concat(l===e.href?"bg-primary text-white":"bg-white text-primary hover:bg-primary-light hover:text-white"),children:e.label},e.href))})}},8820:function(e,a,t){t.d(a,{P2:function(){return u},yg:function(){return o},OU:function(){return m},xw:function(){return g}});var r=t(1545);t(257);let l="https://ypzpkdgdbzruagjixwyc.supabase.co",n="sb_publishable_qTJmNRw6ugSBXzNMOU79hg_yrECc3f4",s=l&&n?(0,r.eI)(l,n):null;var d=t(3448);async function o(e,a,t){let{start:r,end:l}=(0,d.FK)(e,a),n=s.from("deals").select("*").gte("created_at",r.toISOString()).lte("created_at",l.toISOString());n="elopement"===t?n.eq("is_elopement",!0):n.eq("is_elopement",!1);let{data:o,error:i}=await n;return i?(console.error("Error fetching deals:",i),[]):o}let i=["SDR Weddings","Closer Weddings","Planejamento Weddings"];function c(e,a,t){if(!e)return!1;let r=new Date(e);return r.getFullYear()===a&&r.getMonth()+1===t}function u(e,a,t){return{leads:e.length,mql:e.filter(e=>e.pipeline&&i.includes(e.pipeline)).length,agendamento:e.filter(e=>c(e.data_reuniao_1,a,t)).length,reunioes:e.filter(e=>c(e.data_reuniao_1,a,t)&&null!==e.como_reuniao_1&&""!==e.como_reuniao_1&&"N\xe3o teve reuni\xe3o"!==e.como_reuniao_1).length,qualificado:e.filter(e=>c(e.data_qualificado,a,t)||!0===e.qualificado_sql).length,closerAgendada:e.filter(e=>c(e.data_closer,a,t)||null!==e.data_closer&&""!==e.data_closer).length,closerRealizada:e.filter(e=>null!==e.reuniao_closer&&""!==e.reuniao_closer).length,vendas:e.filter(e=>{var r;return c(e.data_fechamento,a,t)&&!(null===(r=e.title)||void 0===r?void 0:r.startsWith("EW"))}).length}}async function m(e,a,t){let r="".concat(e,"-").concat(String(a).padStart(2,"0"),"-01"),{data:l,error:n}=await s.from("monthly_targets").select("*").eq("month",r).eq("pipeline_type","elopement"===t?"elopement":"wedding").maybeSingle();return n?(console.error("Error fetching target:",n),null):l}async function g(e,a,t){let r=e,l=a-1;return 0===l&&(l=12,r=e-1),u(await o(r,l,t),r,l)}},3448:function(e,a,t){t.d(a,{FK:function(){return g},T3:function(){return d},Um:function(){return u},d:function(){return m},d5:function(){return i},up:function(){return c},xG:function(){return s},xc:function(){return o}});var r=t(6139),l=t(3070),n=t(7742);function s(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}function d(e){return"".concat(e.toFixed(2),"%")}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,a=(0,r.N)(e);return e.getDate()/a*100}function i(e,a){return 0===e?0:a/e*100}function c(e,a){return 0===a?0:e/a*100}function u(e,a){return Math.round(a/100*e)}function m(e){return{cvrMql:i(e.leads,e.mql),cvrAg:i(e.mql,e.agendamento),cvrReu:i(e.agendamento,e.reunioes),cvrSql:i(e.reunioes,e.qualificado),cvrRa:i(e.qualificado,e.closerAgendada),cvrRr:i(e.closerAgendada,e.closerRealizada),cvrVenda:i(e.closerRealizada,e.vendas),conversaoTotal:i(e.leads,e.vendas)}}function g(e,a){let t=new Date(e,a-1,1);return{start:(0,l.N)(t),end:(0,n.V)(t)}}}}]);